<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programación de Procesos</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/vs2015.min.css">
</head>

<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">Programación de Procesos</div>
        </div>
    </header>

    <div class="container">
        <main class="main-content">
            <div class="content-header">
                <h1 class="content-title">1.9. Concurrencia en Java (I)</h1>
            </div>

            <div class="lesson-section">

                <p class="text-content">La máquina virtual de Java, el lenguaje Java y la biblioteca de clases estándar
                    de Java se han diseñado para soportar programación concurrente.</p>

                <p class="text-content">La funcionalidad básica para procesos la proporciona la clase
                    <code>Process</code>.
                </p>

                <p class="text-content">La funcionalidad básica para hilos la proporciona la clase <code>Thread</code>.
                    Esta clase implementa la interfaz <code>Runnable</code>.</p>

                <p class="text-content">El paquete <code>java.util.concurrent</code> proporciona funcionalidad de alto
                    nivel para programación concurrente. Incluye varios <em>frameworks</em> y algunas clases
                    adicionales.</p>

                <p class="text-content">El resto de este capítulo se dedica a los procesos. El siguiente capítulo se
                    dedica a los hilos (<em>threads</em>).</p>

                <p class="text-content">La clase <code>Process</code> es abstracta y, por lo tanto, no se pueden crear
                    objetos de ella, sino de subclases suyas, que, de hecho, implementan procesos nativos, es decir,
                    procesos de plataformas específicas que se ejecutan en un sistema operativo particular para un tipo
                    de procesador particular. La clase <code>Process</code> tiene métodos para lanzar un proceso,
                    obtener información acerca de su estado y controlar su ejecución.</p>

                <p class="text-content">Se pueden crear objetos de la clase <code>Process</code> con métodos de otras
                    clases, en particular con <code>ProcessBuilder.start()</code> y <code>Runtime.exec()</code>.</p>

                <h3 class="section-title">1.9.1. La clase Runtime</h3>

                <p class="text-content">Cada programa de Java tiene asociada una instancia de la clase
                    <code>Runtime</code> que le permite obtener información del entorno de ejecución e interactuar con
                    él. Esta se puede recuperar con el método estático <code>getRuntime()</code>. Las diversas variantes
                    del método <code>exec()</code> permiten lanzar nuevos procesos.
                </p>

                <p class="text-content">En el cuadro 1.2 se muestran algunos de los métodos de esta clase.</p>

                <div class="table-container">
                    <h4 class="table-title">Cuadro 1.2 - Métodos de la clase Runtime</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Método</th>
                                <th>Funcionalidad</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>static Runtime getRuntime()</code></td>
                                <td>Devuelve el objeto <code>Runtime</code> asociado con la aplicación de Java actual.
                                </td>
                            </tr>
                            <tr>
                                <td><code>Process exec(String command)</code><br>
                                    <code>Process exec(String[]</code><br>
                                    <code>comandYArgs)</code><br><code>Process exec(String[]</code><br>
                                    <code>comandYArgs, String[] envp)</code><br>
                                    <code>Process exec(String[] cmdarray,</code><br>
                                    <code>String[] envp, File dir)</code>
                                </td>
                                <td>Ejecuta un comando. Algunas variantes permiten especificar el entorno de ejecución y
                                    el directorio para ejecutar el comando.</td>
                            </tr>
                            <tr>
                                <td><code>void exit(int status)</code><br>
                                    <code>void halt(int status)</code>
                                </td>
                                <td>Termina la ejecución de la máquina virtual. El primer método lo hace de manera
                                    ordenada, y el segundo, de manera abrupta.</td>
                            </tr>
                            <tr>
                                <td><code>int availableProcessors()</code></td>
                                <td>Devuelve el número de procesadores disponibles para la máquina virtual de Java.</td>
                            </tr>
                            <tr>
                                <td><code>long freeMemory()</code></td>
                                <td>Devuelve la cantidad de memoria disponible para la máquina virtual.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="section-title">1.9.2. Las clases Process y ProcessBuilder</h3>

                <p class="text-content"><code>Process</code> es una clase abstracta. Se pueden obtener instancias de
                    subclases suyas que proporcionan implementaciones para una plataforma particular, con métodos de la
                    clase <code>ProcessBuilder</code>.</p>

                <p class="text-content">Con <code>ProcessBuilder</code> se puede configurar previamente el entorno de
                    ejecución de los procesos que crea y, en particular, como se verá en breve, redirigir su entrada y
                    salida. En el cuadro 1.3 se muestran algunos de sus métodos.</p>

                <div class="table-container">
                    <h4 class="table-title">Cuadro 1.3 - Métodos de la clase ProcessBuilder</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Método</th>
                                <th>Funcionalidad</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>ProcessBuilder(String comando)</code><br>
                                    <code>ProcessBuilder(List&lt;String&gt;</code><br>
                                    <code>comando)</code>
                                </td>
                                <td>Construye un <code>ProcessBuilder</code> para un comando con los correspondientes
                                    argumentos de línea de comandos, en su caso.</td>
                            </tr>
                            <tr>
                                <td><code>ProcessBuilder directory(File</code><br>
                                    <code>directorio)</code><br>
                                    <code>File directory()</code>
                                </td>
                                <td>El primer método establece el directorio de trabajo del proceso, y el segundo método
                                    lo devuelve. Por defecto, el segundo método normalmente devuelve <code>null</code>.
                                    Si es así, se puede obtener el directorio de ejecución del proceso actual con
                                    <code>System.getProperty("user.dir")</code>.
                                </td>
                            </tr>
                            <tr>
                                <td><code>Map&lt;String,String&gt;</code><br>
                                    <code>environment()</code>
                                </td>
                                <td>Devuelve el entorno de trabajo del proceso, que es una lista de asignación de
                                    valores para variables de entorno.</td>
                            </tr>
                            <tr>
                                <td><code>Process start()</code></td>
                                <td>Crea e inicia un proceso.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <p class="text-content">El cuadro 1.4 muestra los principales métodos de la clase Process.</p>

                <div class="table-container">
                    <h4 class="table-title">Cuadro 1.4 - Métodos de la clase Process</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Método</th>
                                <th>Funcionalidad</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>void destroy()</code><br>
                                    <code>public Process</code><br>
                                    <code>destroyForcibly()</code>
                                </td>
                                <td>Termina el proceso. El primer método permite una terminación limpia y ordenada del
                                    proceso. El segundo lo termina inmediatamente.</td>
                            </tr>
                            <tr>
                                <td><code>int exitValue()</code></td>
                                <td>Devuelve el valor de salida, o código de retorno, del proceso. Por convención, un
                                    valor 0 indica terminación normal, y otro valor se interpretará como un código de
                                    error. Se puede terminar un programa en Java con un código de retorno distinto de 0
                                    con <code>System.exit(código)</code>.</td>
                            </tr>
                            <tr>
                                <td><code>ProcessHandle.Info info()</code></td>
                                <td>Devuelve la información actual del proceso.</td>
                            </tr>
                            <tr>
                                <td><code>boolean isAlive()</code></td>
                                <td>Comprueba si el proceso está vivo.</td>
                            </tr>
                            <tr>
                                <td><code>long pid()</code></td>
                                <td>Devuelve el PID o identificador de proceso.</td>
                            </tr>
                            <tr>
                                <td><code>int waitFor()</code></td>
                                <td>Hace que el hilo en ejecución espere hasta que el proceso haya terminado. Devuelve
                                    el valor de salida del proceso. Un valor cero se entiende que corresponde a una
                                    ejecución sin errores, mientras que un valor distinto de cero corresponde a un
                                    código de error. Si el proceso es de un programa en Java, es el valor devuelto por
                                    <code>System.exit()</code>, o cero si no se terminó la ejecución con
                                    <code>System.exit()</code>.
                                </td>
                            </tr>
                            <tr>
                                <td><code>boolean waitFor(long</code><br>
                                    <code>timeout,</code><br>
                                    <code>TimeUnit unit)</code>
                                </td>
                                <td>Hace que el hilo en ejecución espere hasta que el proceso haya terminado, durante un
                                    tiempo máximo indicado por <code>timeout</code>. Devuelve <code>true</code> si el
                                    proceso ha terminado por sí mismo antes del tiempo máximo indicado, y
                                    <code>false</code> en caso contrario.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <p class="text-content">Cualquiera de los múltiples errores que se pueden producir durante la creación y
                    ejecución del proceso hará que se produzca una excepción, en general, de la clase
                    <code>IOException</code>.
                </p>

                <p class="text-content">El siguiente programa de ejemplo crea un proceso para un comando que se pasa
                    como parámetros de línea de comandos en args. Estos se pasan directamente al creador de
                    <code>ProcessBuilder</code> con <code>ProcessBuilder(args)</code>. La llamada a
                    <code>inheritIO()</code> hace que el proceso herede la entrada y salida estándares del proceso
                    padre. Con <code>waitFor()</code> se espera a que termine la ejecución del proceso hijo y se obtiene
                    el código de retorno. Si, mientras eso sucede, se interrumpe la ejecución del programa, se lanzaría
                    una excepción de tipo <code>InterruptedException</code>, que este programa capturaría, y de la que
                    informaría.
                </p>
                <div class="code-container">
                    <div class="code-header">
                        <span>Lanzador de procesos</span>
                        <span class="language-badge">java</span>
                    </div>
                    <div class="code-content">
                        <button class="copy-button">Copiar</button>
                        <pre><code>import java.util.Arrays;
import java.io.IOException;

public class LanzaProceso {

  public static void main(String[] args) {

    if (args.length <= 0) {
      System.out.println("Debe indicarse comando a ejecutar.");
      System.exit(1);
    }

    ProcessBuilder pb = new ProcessBuilder(args);
    pb.inheritIO();

    try {
      Process p = pb.start();
      int codRet = p.waitFor();
      System.out.println("La ejecución de " + Arrays.toString(args)
              + " devuelve " + codRet
              + " " + (codRet == 0 ? "(ejecución correcta)" : "(ERROR)")
      );
    } catch (IOException e) {
      System.err.println("Error durante ejecución del proceso");
      System.err.println("Información detallada");
      System.err.println("---------------------");
      e.printStackTrace();
      System.err.println("---------------------");
      System.exit(2);
    } catch (InterruptedException e) {
      System.err.println("Proceso interrumpido");
      System.exit(3);
    }
  }
}</code></pre>
                    </div>
                </div>
</div>
        </main>
    </div>
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="js/main.js"></script>
</body>

</html>